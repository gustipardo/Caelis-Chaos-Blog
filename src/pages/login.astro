---
import Layout from "@/layout/Layout.astro";
import '@/styles/global.css'
import { SignIn, SignOut } from 'auth-astro/components'
import { getSession } from 'auth-astro/server';

const session = await getSession(Astro.request)
console.log(session)

console.log(session?.user?.id)
const addNewUser = async (user: any) => {
    try {
        const res = await fetch("http://localhost:1234/users", {
            method: 'POST',
            body: JSON.stringify({
                id: user.id,
                username: user.name,
                email: user.email,
                image_url: user.image,
            }),
            headers: {
                'Content-Type': 'application/json',
            },
        })
    } catch (error) {
      console.error("Error creating new user:", error)
    }
}
addNewUser(session?.user)
---

<Layout title="Log In">
    <div>Hola esta es la pagina para inciar sesion</div>
    {
        session ? (
            <div>
                <p>Hola, {session.user?.name}</p>
                <button id="logout">Logout</button>
            </div>
        ) : (
            <button id="login-google">Login Google</button>
        )
    }
</Layout>
<script>
    const { signIn, signOut } = await import("auth-astro/client")
    const loginGoogle = document.querySelector("#login-google") as HTMLElement
    const logout =  document.querySelector("#logout") as HTMLElement

    if(loginGoogle) loginGoogle.onclick = () => signIn("google")
    if(logout) logout.onclick = () => signOut()


</script>
