---
/* import '@/styles/global.css' */
import Response from "@/components/Response.astro";
import Layout from "@/layout/Layout.astro"
import getTopicById from '@/services/getTopicById';
import getResponsesById from '@/services/getResponsesById';
import Title from '@/components/Title.astro';
import NewResponseForm from '@/components/NewResponseForm.jsx'
import { getSession } from 'auth-astro/server';

const {topicId} = Astro.params
console.log(topicId)

const Responses = await getResponsesById({id: topicId})
console.log(Responses)

const Topic = await getTopicById({topicId: topicId})
console.log(Topic)

const session = await getSession(Astro.request)
console.log(session)

const userId = session?.user?.id
---

<Layout>
    <h2 class="titleTopic">
        {Topic.title}   
    </h2>
    <div class="topic-container">
        <div class="user-profile">
            <img class="image" src={Topic.author_image} alt={Topic.author_username} />
            <div class="user-info">
                <p class="author_username">@{Topic.author_username}</p>
        <!--             <p class="author_name">Tobias Bersia</p> -->
            </div>
        </div>
        <div class="topic-content">
            <p class="topic-text-content">{Topic.content}</p>
        </div>

        { 
        Responses.map((response: any)=> (
        <Response 
        response_id={response.response_id}
        imageSrc={response.author_image} 
        username={response.author_username}  
        content={response.content}  
        quote={response.quoted_response_id}   />
        ))
        }
        <div class="response-container">

            <NewResponseForm user_id={userId} topicId={topicId} client:load />
        </div>

    </div>
</Layout>
<style>
    .response-container {
  padding: 12px;
  display: block;
  width: 96%;
  border-bottom: 1px solid var(--gray);
  border-right: 1px solid var(--gray);
  text-align: right;
}

         .image {
            border-radius: 100%;
            border: 4px solid var(--primary);
            grid-area: image;
            height: 100px;
            aspect-ratio: 1 / 1;
        }

        .user-profile{
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            justify-content: flex-start;
            padding: 12px;
        }
        .user-info{
            margin-left: 12px;
            text-align: left;
        }
        .author_username{
            color: var(--primary);
            font-size: 24px;
            width: 100%;
        }

        .author_name{
            color: var(--primary);
            font-size: 24px;
        }

        .topic-content{
            border-bottom: 1px solid var(--gray);
        }
        .topic-text-content{
            margin-bottom: 12px;
            text-align: left;
            padding: 12px;
        }
        .titleTopic{
            font-size: 36px;
            color: var(--primary);
            font-family: source_serif_pro;
            height: 48px;
            width: fit-content;
            text-align: center;
            margin-inline: 24px;
            margin-top: 24px;
            margin-bottom: 12px;
            height: fit-content;
            line-height: 1.2; 
        }
</style>
